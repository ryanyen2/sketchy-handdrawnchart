<!DOCTYPE html>
<html>
  <head>
    <title>Universal Vega-Lite Sketchy Converter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <style>
    @font-face {
      font-family: 'xkcd';
      src: url('./Humor-Sans.ttf');
    }

    body {
      font-size: 14px;
      font-family: 'xkcd', sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
      margin: 0;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-style: italic;
    }
    
    .chart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .chart-demo {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .chart-header {
      background: #34495e;
      color: white;
      padding: 15px 20px;
      font-size: 16px;
      font-weight: bold;
    }
    
    .chart-content {
      padding: 20px;
    }
    
    .chart-pair {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: start;
    }
    
    .chart-item h4 {
      text-align: center;
      margin-bottom: 10px;
      color: #444;
      font-size: 14px;
    }
    
    .chart-container {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      background: #fafafa;
      min-height: 280px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .controls {
      background: #ecf0f1;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 30px;
    }
    
    .control-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .control-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .control-group input[type="range"] {
      width: 100%;
      margin-bottom: 3px;
    }
    
    .control-group input[type="checkbox"] {
      margin-right: 5px;
    }
    
    .range-value {
      font-size: 10px;
      color: #666;
      text-align: center;
    }
    
    button {
      background: #3498db;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
      width: 100%;
    }
    
    button:hover {
      background: #2980b9;
    }
    
    path {
      fill: none;
      stroke-width: 1.5px;
    }
    
    .vega-embed details {
      display: none !important;
    }
    
    .performance-info {
      background: #e8f5e8;
      border: 1px solid #4CAF50;
      padding: 10px;
      border-radius: 4px;
      margin-top: 20px;
      font-size: 12px;
    }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="./js/d3.min.js"></script>
    <script type="text/javascript" src="./js/require.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>üé® Universal Vega-Lite Sketchy Converter</h1>
      <p class="subtitle">Transform any chart type into hand-drawn sketches! Supports bar charts, line charts, scatter plots, area charts, and large datasets.</p>
      
      <div class="controls">
        <h3 style="margin: 0 0 15px 0;">Global Controls</h3>
        <div class="control-grid">
          <div class="control-group">
            <label for="globalRoughness">Roughness</label>
            <input type="range" id="globalRoughness" min="0" max="2" step="0.1" value="0.8" 
                   onchange="updateAllCharts(); document.getElementById('roughness-val').textContent = this.value">
            <div class="range-value" id="roughness-val">0.8</div>
          </div>
          
          <div class="control-group">
            <label for="globalBowing">Bowing</label>
            <input type="range" id="globalBowing" min="0" max="2" step="0.1" value="0.8"
                   onchange="updateAllCharts(); document.getElementById('bowing-val').textContent = this.value">
            <div class="range-value" id="bowing-val">0.8</div>
          </div>
          
          <div class="control-group">
            <label for="maxDataPoints">Max Data Points</label>
            <input type="range" id="maxDataPoints" min="100" max="2000" step="100" value="1000"
                   onchange="updateAllCharts(); document.getElementById('points-val').textContent = this.value">
            <div class="range-value" id="points-val">1000</div>
          </div>
          
          <div class="control-group">
            <button onclick="updateAllCharts()">üîÑ Regenerate All Charts</button>
          </div>
        </div>
      </div>

      <div class="chart-grid">
        <!-- Bar Chart Demo -->
        <div class="chart-demo">
          <div class="chart-header">üìä Bar Chart</div>
          <div class="chart-content">
            <div class="chart-pair">
              <div class="chart-item">
                <h4>Original Vega-Lite</h4>
                <div class="chart-container" id="bar-original"></div>
              </div>
              <div class="chart-item">
                <h4>Sketchy Version</h4>
                <div class="chart-container" id="bar-sketchy"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Line Chart Demo -->
        <div class="chart-demo">
          <div class="chart-header">üìà Line Chart</div>
          <div class="chart-content">
            <div class="chart-pair">
              <div class="chart-item">
                <h4>Original Vega-Lite</h4>
                <div class="chart-container" id="line-original"></div>
              </div>
              <div class="chart-item">
                <h4>Sketchy Version</h4>
                <div class="chart-container" id="line-sketchy"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Area Chart Demo -->
        <div class="chart-demo">
          <div class="chart-header">üèîÔ∏è Area Chart</div>
          <div class="chart-content">
            <div class="chart-pair">
              <div class="chart-item">
                <h4>Original Vega-Lite</h4>
                <div class="chart-container" id="area-original"></div>
              </div>
              <div class="chart-item">
                <h4>Sketchy Version</h4>
                <div class="chart-container" id="area-sketchy"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scatter Plot Demo -->
        <div class="chart-demo">
          <div class="chart-header">üéØ Scatter Plot</div>
          <div class="chart-content">
            <div class="chart-pair">
              <div class="chart-item">
                <h4>Original Vega-Lite</h4>
                <div class="chart-container" id="scatter-original"></div>
              </div>
              <div class="chart-item">
                <h4>Sketchy Version</h4>
                <div class="chart-container" id="scatter-sketchy"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Large Dataset Demo -->
        <div class="chart-demo">
          <div class="chart-header">‚ö° Large Dataset (20+ points)</div>
          <div class="chart-content">
            <div class="chart-pair">
              <div class="chart-item">
                <h4>Original Vega-Lite</h4>
                <div class="chart-container" id="large-original"></div>
              </div>
              <div class="chart-item">
                <h4>Sketchy Version</h4>
                <div class="chart-container" id="large-sketchy"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Color-encoded Chart Demo -->
        <div class="chart-demo">
          <div class="chart-header">üé® Color-encoded Scatter Plot</div>
          <div class="chart-content">
            <div class="chart-pair">
              <div class="chart-item">
                <h4>Original Vega-Lite</h4>
                <div class="chart-container" id="color-original"></div>
              </div>
              <div class="chart-item">
                <h4>Sketchy Version</h4>
                <div class="chart-container" id="color-sketchy"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="performance-info">
        <strong>Performance Features:</strong><br>
        ‚Ä¢ Automatic data sampling for datasets > 1000 points<br>
        ‚Ä¢ Configurable sampling methods (uniform, random)<br>
        ‚Ä¢ Support for temporal, quantitative, nominal, and ordinal scales<br>
        ‚Ä¢ Color encoding with categorical and continuous scales<br>
        ‚Ä¢ Size encoding for scatter plots<br>
        ‚Ä¢ Optimized rendering for large datasets
      </div>
    </div>

    <script>
    require(["./js/vegaSketchyConverter"], function(VegaSketchyConverter) {
      
      var converter = new VegaSketchyConverter();

      // Generate sample data
      function generateTimeSeriesData(points) {
        var data = [];
        var startDate = new Date('2023-01-01');
        for (var i = 0; i < points; i++) {
          var date = new Date(startDate.getTime() + i * 24 * 60 * 60 * 1000);
          data.push({
            date: date.toISOString().split('T')[0],
            value: 50 + 30 * Math.sin(i * 0.1) + Math.random() * 20 - 10,
            category: i % 2 === 0 ? 'A' : 'B'
          });
        }
        return data;
      }

      function generateScatterData(points) {
        var data = [];
        var categories = ['Alpha', 'Beta', 'Gamma', 'Delta'];
        for (var i = 0; i < points; i++) {
          data.push({
            x: Math.random() * 1.4,
            y: Math.random() * 1.3,
            category: categories[Math.floor(Math.random() * categories.length)],
            size: Math.random() * 1.2
          });
        }
        return data;
      }

      // Chart specifications
      var specs = {
        bar: {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "width": 200, "height": 150,
          "data": {
            "values": [
              {"category": "A", "value": 85}, {"category": "B", "value": 72},
              {"category": "C", "value": 63}, {"category": "D", "value": 48},
              {"category": "E", "value": 35}
            ]
          },
          "mark": {"type": "bar", "color": "#3498db"},
          "encoding": {
            "x": {"field": "category", "type": "nominal", "axis": {"title": "Category"}},
            "y": {"field": "value", "type": "quantitative", "axis": {"title": "Value"}}
          }
        },

        line: {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "width": 200, "height": 150,
          "data": {"values": generateTimeSeriesData(30)},
          "mark": {"type": "line", "color": "#e74c3c", "strokeWidth": 2},
          "encoding": {
            "x": {"field": "date", "type": "temporal", "axis": {"title": "Date"}},
            "y": {"field": "value", "type": "quantitative", "axis": {"title": "Value"}}
          }
        },

        scatter: {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "width": 200, "height": 150,
          "data": {"values": generateScatterData(20)},
          "mark": {"type": "point", "filled": true},
          "encoding": {
            "x": {"field": "x", "type": "quantitative", "axis": {"title": "X Value"}},
            "y": {"field": "y", "type": "quantitative", "axis": {"title": "Y Value"}},
            "size": {"field": "size", "type": "quantitative"}
          }
        },

        area: {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "width": 200, "height": 150,
          "data": {"values": generateTimeSeriesData(20)},
          "mark": {"type": "area", "color": "#2ecc71", "opacity": 0.7},
          "encoding": {
            "x": {"field": "date", "type": "temporal", "axis": {"title": "Date"}},
            "y": {"field": "value", "type": "quantitative", "axis": {"title": "Value"}}
          }
        },

        large: {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "width": 200, "height": 150,
          "data": {"values": generateScatterData(80)},
          "mark": {"type": "point", "size": 10},
          "encoding": {
            "x": {"field": "x", "type": "quantitative", "axis": {"title": "X Value"}},
            "y": {"field": "y", "type": "quantitative", "axis": {"title": "Y Value"}}
          }
        },

        color: {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "width": 200, "height": 150,
          "data": {"values": generateScatterData(80)},
          "mark": {"type": "point", "size": 60},
          "encoding": {
            "x": {"field": "x", "type": "quantitative", "axis": {"title": "X Value"}},
            "y": {"field": "y", "type": "quantitative", "axis": {"title": "Y Value"}},
            "color": {"field": "category", "type": "nominal"}
          }
        }
      };

      // Initialize charts
      function initChart(type) {
        vegaEmbed('#' + type + '-original', specs[type], {actions: false});
        updateChart(type);
      }

      function updateChart(type) {
        var options = {
          roughness: parseFloat(document.getElementById('globalRoughness').value),
          bowing: parseFloat(document.getElementById('globalBowing').value),
          maxDataPoints: parseInt(document.getElementById('maxDataPoints').value),
          samplingMethod: 'uniform'
        };
        
        converter.convert(specs[type], type + '-sketchy', options)
                 .then(function(chart) {
                   console.log(type + ' chart converted successfully');
                 })
                 .catch(function(error) {
                   console.error('Error converting ' + type + ' chart:', error);
                 });
      }

      // Update charts sequentially with delay
      window.updateAllCharts = function() {
        var chartTypes = Object.keys(specs);
        var currentIndex = 2;

        function updateNextChart() {
          if (currentIndex < chartTypes.length) {
            updateChart(chartTypes[currentIndex]);
            // currentIndex++;
            setTimeout(updateNextChart, 3000); // 300ms delay between updates
          }
        }

        // updateNextChart();
      };

      // Initialize charts sequentially
      setTimeout(function() {
        var chartTypes = Object.keys(specs);
        var currentIndex = 0;

        function initNextChart() {
          if (currentIndex < chartTypes.length) {
            console.log('Initializing ' + chartTypes[currentIndex] + ' chart');
            initChart(chartTypes[currentIndex]);
            currentIndex++;
            setTimeout(initNextChart, 5000); // 5000ms delay between initializations
          }
        }

        initNextChart();
      }, 10000);

    });
    </script>
  </body>
</html>
